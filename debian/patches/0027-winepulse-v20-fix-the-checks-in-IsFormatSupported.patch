From 824fc6ecfad213000ca8e93c147687530c34ea87 Mon Sep 17 00:00:00 2001
From: Maarten Lankhorst <maarten.lankhorst@canonical.com>
Date: Mon, 14 Jul 2014 09:50:04 +0200
Subject: [PATCH 27/42] winepulse v20: fix the checks in IsFormatSupported

Thanks to DGhost001 for reporting and isolating the issue.
---
 dlls/winepulse.drv/mmdevdrv.c | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/dlls/winepulse.drv/mmdevdrv.c b/dlls/winepulse.drv/mmdevdrv.c
index 643d55e..86dd10a 100644
--- a/dlls/winepulse.drv/mmdevdrv.c
+++ b/dlls/winepulse.drv/mmdevdrv.c
@@ -1443,6 +1443,10 @@ static HRESULT WINAPI AudioClient_IsFormatSupported(IAudioClient *iface,
         }
     }
 
+    if (fmt->nBlockAlign != fmt->nChannels * fmt->wBitsPerSample / 8 ||
+        fmt->nAvgBytesPerSec != fmt->nBlockAlign * fmt->nSamplesPerSec)
+        hr = S_FALSE;
+
     if (hr == S_OK || !out) {
         CoTaskMemFree(closest);
         if (out)
-- 
2.0.0

